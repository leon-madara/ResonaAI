version: '3.8'

services:
  resona-demo:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: resona-demo-generator
    ports:
      - "3000:3000"  # Frontend port
      - "8001:8001"  # API port
    environment:
      # Demo Configuration
      - DEMO_NUM_USERS=10
      - DEMO_CONVERSATIONS_PER_USER=5
      - DEMO_CULTURAL_SCENARIOS=20
      - DEMO_SWAHILI_PATTERNS=50
      - DEMO_OUTPUT_DIR=demo_data
      - DEMO_INCLUDE_CRISIS=true
      - DEMO_CRISIS_PERCENTAGE=0.1
      
      # Service Configuration
      - DEMO_API_PORT=8001
      - DEMO_FRONTEND_PORT=3000
      - DEMO_AUTO_BROWSER=false  # Disabled in container
      - DEMO_PROCESSING_DELAY=500
      
      # Development Settings
      - DEMO_DEBUG=false
      - DEMO_VERBOSE=false
      - DEMO_SKIP_BROWSER=true
    volumes:
      - demo_data:/app/demo_data
      - ./logs:/app/logs
    networks:
      - resona-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8001/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

  # Optional: Nginx reverse proxy
  nginx:
    image: nginx:alpine
    container_name: resona-demo-proxy
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - ./nginx.conf:/etc/nginx/nginx.conf:ro
      - ./ssl:/etc/nginx/ssl:ro
    depends_on:
      - resona-demo
    networks:
      - resona-network
    restart: unless-stopped
    profiles:
      - proxy

volumes:
  demo_data:
    driver: local

networks:
  resona-network:
    driver: bridge